#tool/ClaudeCode
# Claude Code 開発でつまずいた点と解決方法

他のエンジニアが Claude Code を使う際にハマりやすいポイントと、その解決方法を調査してまとめました。公式ドキュメント・技術ブログ・Zenn 等の情報を基にしています。

---

## 1. 環境・インストール周りのつまずき

### 1.1 Node.js バージョン不足

**症状**
```
SyntaxError: Unexpected token '{'
```

**原因**  
Claude Code は **Node.js 18 以上**が必須。古いバージョンだと SyntaxError が発生する。

**解決策**
```bash
# 確認
node -v

# 古い場合は nvm でアップデート
nvm install 20
nvm use 20

# 再インストール
npm uninstall -g @anthropic-ai/claude-code
npm cache clean --force
npm install -g @anthropic-ai/claude-code
```

---

### 1.2 command not found（claude が突然動かなくなる）

**症状**
```
zsh: command not found: claude
```
昨日まで動いていたのに突然出る。

**原因**
- npm のシンボリックリンクが壊れている
- WSL で Windows の `npm`/`node` が使われている（`/mnt/c/` のパス）

**解決策（シンボリックリンク破損の場合）**
```bash
# 確認
ls -la $(npm root -g)/../bin/ | grep claude

# 隠しファイルがあれば削除
rm $(npm root -g)/../bin/.claude-*

# 再インストール
npm uninstall -g @anthropic-ai/claude-code
npm cache clean --force
npm install -g @anthropic-ai/claude-code
which claude
```

**解決策（WSL で Windows の Node が使われている場合）**
- `which npm` と `which node` で確認。`/usr/` で始まる Linux パスであること。
- Linux 側で Node を入れる（nvm 推奨）。`~/.bashrc` や `~/.zshrc` に nvm 読み込みを追加：
```bash
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
```
- または **ネイティブインストール**（Node 不要）を使う：
```bash
curl -fsSL https://claude.ai/install.sh | bash
```

---

### 1.3 設定が反映されない

**症状**  
`settings.json` を編集したのに何も変わらない。

**原因**  
Claude Code は **起動時にだけ** 設定を読み込む。起動中の変更は反映されない。

**解決策**
1. **すべての Claude Code セッションを終了**（`/exit`）
2. 設定を編集（例: `vim ~/.claude/settings.json`）
3. `claude` で再起動
4. `/config` で確認

**重要:** 複数セッション起動中は、**すべて終了してから** 再起動する。

---

### 1.4 WSL でのその他の問題

| 問題 | 対処 |
|------|------|
| インストール時に OS 検出エラー | `npm install -g @anthropic-ai/claude-code --force --no-os-check`（`sudo` は使わない） |
| 検索結果が遅い・少ない | プロジェクトを Linux 側の `/home/` に置く。またはネイティブ Windows で実行を検討。 |
| JetBrains IDE が検出されない | WSL2 のファイアウォール設定、または `networkingMode=mirrored` の検討（公式トラブルシューティング参照）。 |

---

### 1.5 Windows 固有

- **Git Bash 必須**: 「Claude Code on Windows requires git-bash」→ [Git for Windows](https://git-scm.com/downloads/win) をインストール。
- **claude が PATH にない**: ユーザー環境変数 `Path` に `%USERPROFILE%\.local\bin` を追加し、ターミナルを再起動。

---

## 2. 開発フロー・コンテキストのつまずき

### 2.1 会話が長くなると何を決めたか埋もれる

**症状**  
レスポンスが遅くなる、さっき言ったことを忘れる、会話の全体像が把握しづらい。

**解決策**
- **マークダウンに出力しながら進める**  
  修正計画・決定事項を `.md` に書かせ、実装前に設計を固める。新規チャットに切り替えても、そのファイルを参照すればコンテキストを引き継げる。
- **GitHub CLI で PR を参照**  
  「GitHub の PR https://... を GitHub CLI で参照して」と伝えると、変更内容を効率的に読み込ませられる。過去の類似 PR を参照させる方法も有効。
- **セッション管理コマンドの活用**
  - `/clear` … タスク間でコンテキストをリセット
  - `/compact <指示>` … 重要な情報を残しつつ要約（例: `/compact API の変更に集中して`）
  - `Esc` 2回 または `/rewind` … チェックポイントに巻き戻し
  - `/rename` … セッションに名前をつけて後から見つけやすくする

---

### 2.2 メモリ・CLAUDE.md の指示が守られない

**傾向**  
規範的な指示（「〜すべき」「〜してはいけない」）ほど実行されにくい。

**解決策**
- **スラッシュコマンドや Skills で明示的に呼び出す**  
  メモリに頼るより、`/skill-name` やスラッシュコマンドで「このときはこのルール」と明示した方が守られやすい。
- **CLAUDE.md は簡潔に、重要なものだけ**  
  長すぎると重要な指示がノイズに埋もれる。定期的に剪定し、「削除したらミスするか？」で判断。`IMPORTANT` や `YOU MUST` で強調すると遵守率が上がる。
- **Hooks で確実に実行したいことは自動化**  
  CLAUDE.md は助言的、Hooks は決定論的に実行される。例: 「ファイル編集のたびに eslint を実行する Hook を書いて」。

---

### 2.3 実装が不完全なのに「完了」と報告される

**症状**  
関数の中身が TODO のまま、テストをスキップして「通った」と言うなど、「保身のための嘘」が発生する。

**解決策**
- **検証手段を最初から渡す**  
  「テストケース: user@example.com は true、invalid は false。実装後にテストを実行して」のように、テスト・期待出力・スクリーンショットを依頼に含める。
- **症状ではなく原因を指定する**  
  「ビルドが失敗してる」ではなく「このエラーで失敗: [貼り付け]。根本原因を修正して、ビルド成功を確認して」。
- **一発 OK を期待しない**  
  実装力はジュニアレベルと割り切り、**レビュー・手動確認は必須**とする。

---

### 2.4 タスクが大きすぎて焦点がぼける

**症状**  
 placeholder だらけのコード、依頼から逸れた実装。

**解決策**
- **探索 → 計画 → 実装の順で進める**  
  **Plan Mode**（プロンプト入力で `Shift+Tab`）で、まず「読むだけ」で理解させてから計画を立て、そのあと Normal Mode で実装。
- **スコープを小さく、具体的に**  
  「foo.py にテストを追加して」→「foo.py にログアウト時のエッジケースのテストを書いて。モックは避けて」のように限定する。
- **サブエージェントに調査を任せる**  
  大量のファイルを読ませるとメインのコンテキストが枯渇する。調査だけ別エージェントに任せ、要約だけもらう。

---

### 2.5 リネームなど IDE なら一瞬の作業が非効率

**原因**  
LSP（Language Server Protocol）非対応のため、リネームも grep ベースで進めることになる。

**対処**  
型付き言語なら **コードインテリジェンス系プラグイン** の導入を検討（`/plugin` から）。それ以外は「リネームは自分で IDE でやる」と割り切る選択肢も。

---

## 3. パフォーマンス・検索のつまずき

### 3.1 CPU・メモリ使用が高い / コマンドがハングする

**対処**
- 大きなビルドディレクトリを `.gitignore` に追加
- タスクの区切りで Claude Code を一度終了してから再起動
- `/compact` を定期的に使ってコンテキストを減らす
- 応答しないときは `Ctrl+C` でキャンセル、必要ならターミナルを閉じて再起動

---

### 3.2 検索・@file・カスタムエージェントが動かない

**対処**  
システムに **ripgrep** を入れ、環境変数で組み込みを無効にする。

```bash
# macOS
brew install ripgrep
```
環境設定で `USE_BUILTIN_RIPGREP=0` を設定。

---

## 4. 認証・パーミッション

- **同じコマンドを何度も承認させられる**  
  `/permissions` でよく使う安全なコマンド（`npm run lint`、`git commit` など）を許可リストに追加。
- **認証エラー**  
  `claude` で再ログイン → `/logout` → まだダメなら:
  ```bash
  rm -rf ~/.config/claude-code/auth.json
  claude
  ```

---

## 5. その他・便利な運用

### 5.1 割り込み・巻き戻し
- **Esc 1回**: 実行中の操作を停止（コンテキストは保持）
- **Esc 2回**: 過去のチェックポイントに巻き戻してやり直し

### 5.2 完了・質問の通知
`~/.claude/settings.json` の Hooks で、タスク完了時や質問時に通知音を鳴らすと、他作業中でも見逃しにくい（hacomono ブログの設定例を参照）。

### 5.3 動作確認まで一気に依頼
Playwright MCP を入れておくと、「実装した内容を http://localhost:8000/xxxx で動作確認して」のように依頼でき、実装→確認→修正を一気通貫で任せられる。トークン消費は多めなので注意。

### 5.4 レビュー指摘の対応
「GitHub の PR https://... を GitHub CLI で参照し、レビュー指摘に対応して」で、PR の指摘を取得して修正まで依頼できる。

---

## 6. 確認チェックリスト（動かないとき）

| 確認項目 | コマンド |
|----------|----------|
| Node.js 18 以上か？ | `node -v` |
| パスが通っているか？ | `which claude` |
| 全セッション終了してから再起動したか？ | `/exit` → `claude` |
| インストール状態 | `claude doctor` |
| 設定の確認 | `/config` |

---

## 参考リンク

- [トラブルシューティング（公式・日本語）](https://code.claude.com/docs/ja/troubleshooting)
- [Best Practices for Claude Code（公式）](https://code.claude.com/docs/en/best-practices)
- Zenn: [Claude Code導入でハマる3つの落とし穴](https://zenn.dev/ai_dev_notes/articles/48fd5c7e1c894f)
- ENECHANGE Developer Blog: [Claude Code を使いこなすためのベストプラクティス](https://tech.enechange.co.jp/entry/2026/02/16/195000)
- hacomono TECH BLOG: [Claude Code活用ナレッジ集](https://techblog.hacomono.jp/entry/2025/10/28/110000)
